<!DOCTYPE html>
<html>
<head>
    <title>Pirate Game WebSocket Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f0f8ff; }
        .container { max-width: 800px; margin: 0 auto; }
        .header { background: #2c3e50; color: white; padding: 1rem; border-radius: 8px; text-align: center; }
        .controls { background: white; padding: 1rem; border-radius: 8px; margin: 1rem 0; }
        .log { background: #1a1a1a; color: #00ff00; font-family: monospace; padding: 1rem; 
               border-radius: 8px; height: 400px; overflow-y: scroll; margin: 1rem 0; }
        button { background: #3498db; color: white; border: none; padding: 0.5rem 1rem; 
                 border-radius: 4px; cursor: pointer; margin: 0.25rem; }
        button:hover { background: #2980b9; }
        button:disabled { background: #bdc3c7; cursor: not-allowed; }
        input { padding: 0.5rem; margin: 0.25rem; border: 1px solid #ccc; border-radius: 4px; }
        .status { padding: 0.5rem; border-radius: 4px; margin: 0.5rem 0; font-weight: bold; }
        .status.connected { background: #d4edda; color: #155724; }
        .status.disconnected { background: #f8d7da; color: #721c24; }
        .status.connecting { background: #fff3cd; color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¥‚Äç‚ò†Ô∏è Pirate Game WebSocket Test Client</h1>
        </div>
        
        <div id="status" class="status disconnected">Disconnected</div>
        
        <div class="controls">
            <h3>Connection</h3>
            <input type="text" id="serverUrl" value="ws://localhost:8082" placeholder="WebSocket URL">
            <button id="connectBtn" onclick="connect()">Connect</button>
            <button id="disconnectBtn" onclick="disconnect()" disabled>Disconnect</button>
            
            <h3>Game Commands</h3>
            <button onclick="sendPing()" disabled class="gameCmd">Send PING</button>
            <input type="text" id="playerName" placeholder="Player Name" value="TestPlayer">
            <button onclick="sendJoin()" disabled class="gameCmd">Join Game</button>
            <button onclick="sendState()" disabled class="gameCmd">Get State</button>
            
            <h3>Custom Message</h3>
            <input type="text" id="customMsg" placeholder="Custom message">
            <button onclick="sendCustom()" disabled class="gameCmd">Send Custom</button>
            
            <button onclick="clearLog()">Clear Log</button>
        </div>
        
        <div id="log" class="log">WebSocket Test Client Ready...\n</div>
    </div>

    <script>
        let socket = null;
        let isConnected = false;
        
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function updateStatus(status, message) {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${status}`;
            statusDiv.textContent = message;
            
            // Update button states
            document.getElementById('connectBtn').disabled = isConnected;
            document.getElementById('disconnectBtn').disabled = !isConnected;
            const gameCmds = document.querySelectorAll('.gameCmd');
            gameCmds.forEach(btn => btn.disabled = !isConnected);
        }
        
        function connect() {
            const url = document.getElementById('serverUrl').value;
            
            try {
                updateStatus('connecting', 'Connecting...');
                log(`üîó Connecting to ${url}`);
                
                socket = new WebSocket(url);
                
                socket.onopen = function(event) {
                    isConnected = true;
                    updateStatus('connected', `Connected to ${url}`);
                    log('‚úÖ WebSocket connection established');
                };
                
                socket.onmessage = function(event) {
                    log(`üì® Received: ${event.data}`);
                    
                    // Try to parse as JSON for pretty printing
                    try {
                        const json = JSON.parse(event.data);
                        log(`üìã Parsed JSON: ${JSON.stringify(json, null, 2)}`);
                    } catch (e) {
                        // Not JSON, just plain text
                    }
                };
                
                socket.onerror = function(event) {
                    log(`‚ùå WebSocket error: ${event}`);
                };
                
                socket.onclose = function(event) {
                    isConnected = false;
                    updateStatus('disconnected', 'Disconnected');
                    log(`üîå Connection closed (code: ${event.code}, reason: ${event.reason})`);
                    socket = null;
                };
                
            } catch (error) {
                log(`‚ùå Connection failed: ${error.message}`);
                updateStatus('disconnected', 'Connection failed');
            }
        }
        
        function disconnect() {
            if (socket) {
                socket.close();
            }
        }
        
        function sendMessage(message) {
            if (socket && isConnected) {
                log(`üì§ Sending: ${message}`);
                socket.send(message);
            } else {
                log('‚ùå Not connected');
            }
        }
        
        function sendPing() {
            sendMessage('PING');
        }
        
        function sendJoin() {
            const playerName = document.getElementById('playerName').value || 'TestPlayer';
            sendMessage(`JOIN:${playerName}`);
        }
        
        function sendState() {
            sendMessage('STATE');
        }
        
        function sendCustom() {
            const message = document.getElementById('customMsg').value;
            if (message) {
                sendMessage(message);
                document.getElementById('customMsg').value = '';
            }
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = 'Log cleared...\n';
        }
        
        // Initialize
        updateStatus('disconnected', 'Disconnected');
        log('üè¥‚Äç‚ò†Ô∏è Pirate Game WebSocket Test Client Ready');
        log('Click Connect to start testing WebSocket communication');
    </script>
</body>
</html>